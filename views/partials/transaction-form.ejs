<form id="transaction-form" action="<%= formAction %>" method="POST"<% if (!transaction) { %> enctype="multipart/form-data"<% } %>>
    <% if (typeof canEditStatus !== 'undefined' && canEditStatus && transaction) { %>
        <div class="form-group">
            <label class="form-label">Status</label>
            <div class="radio-group">
                <label class="radio-label">
                    <input type="radio" name="status" value="pending" <%= transaction.status === 'pending' ? 'checked' : '' %> required>
                    Pending
                </label>
                <label class="radio-label">
                    <input type="radio" name="status" value="validated" <%= transaction.status === 'validated' ? 'checked' : '' %> required>
                    Validated
                </label>
            </div>
        </div>
    <% } %>

    <div class="form-group">
        <label class="form-label">Type</label>
        <div class="radio-group">
            <label class="radio-label">
                <input type="radio" name="type" value="income" <%= transaction && transaction.type === 'income' ? 'checked' : '' %> required onchange="filterCategories()">
                Income
            </label>
            <label class="radio-label">
                <input type="radio" name="type" value="expense" <%= transaction && transaction.type === 'expense' ? 'checked' : '' %> <%= !transaction ? 'checked' : '' %> required onchange="filterCategories()">
                Expense
            </label>
        </div>
    </div>

    <div class="form-group">
        <label for="category_id" class="form-label">Category</label>
        <select id="category_id" name="category_id" class="form-input" required>
            <option value="">Select a category</option>
            <% categories.forEach(category => { %>
                <option
                    value="<%= category.id %>"
                    data-type="<%= category.type %>"
                    <%= transaction && transaction.category_id === category.id ? 'selected' : '' %>
                >
                    <%= category.name %>
                </option>
            <% }); %>
        </select>
    </div>

    <div class="form-group">
        <label for="amount" class="form-label">Amount (â‚¬)</label>
        <input
            type="number"
            id="amount"
            name="amount"
            class="form-input"
            min="0.01"
            step="0.01"
            value="<%= transaction ? transaction.amount : '' %>"
            required
        >
    </div>

    <% if (typeof canEditStatus !== 'undefined' && canEditStatus && transaction) { %>
        <div class="form-group">
            <label for="transaction_date" class="form-label">Transaction Date</label>
            <input
                type="date"
                id="transaction_date"
                name="transaction_date"
                class="form-input"
                value="<%= transaction.transaction_date ? new Date(transaction.transaction_date).toISOString().split('T')[0] : '' %>"
            >
            <label class="checkbox-label">
                <input type="checkbox" id="clear_date" name="clear_date" value="true" onchange="toggleTransactionDate()">
                Set as null (clear date)
            </label>
        </div>
    <% } %>

    <div class="form-group">
        <label for="description" class="form-label">Description</label>
        <textarea
            id="description"
            name="description"
            class="form-input form-textarea"
            rows="4"
            minlength="5"
            required
        ><%= transaction ? transaction.description : '' %></textarea>
    </div>

    <% if (!transaction) { %>
        <div class="form-group">
            <label for="documents" class="form-label">Documents (optional)</label>
            <input
                type="file"
                id="documents"
                name="documents"
                class="form-input"
                multiple
                accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx"
            >
            <p class="form-help-small">
                You can also add documents later from the transaction details page.
            </p>
        </div>
    <% } %>

    <button type="submit" class="btn" id="submit-btn">
        <%= transaction ? 'Update Transaction' : 'Create Transaction' %>
    </button>
</form>

<script src="/js/transaction-form.js"></script>

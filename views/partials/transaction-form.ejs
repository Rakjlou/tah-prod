<form id="transaction-form" action="<%= formAction %>" method="POST" enctype="multipart/form-data">
    <div class="form-group">
        <label class="form-label">Type</label>
        <div style="display: flex; gap: 1rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="radio" name="type" value="income" <%= transaction && transaction.type === 'income' ? 'checked' : '' %> required onchange="filterCategories()">
                Income
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="radio" name="type" value="expense" <%= transaction && transaction.type === 'expense' ? 'checked' : '' %> <%= !transaction ? 'checked' : '' %> required onchange="filterCategories()">
                Expense
            </label>
        </div>
    </div>

    <div class="form-group">
        <label for="category_id" class="form-label">Category</label>
        <select id="category_id" name="category_id" class="form-input" required>
            <option value="">Select a category</option>
            <% categories.forEach(category => { %>
                <option
                    value="<%= category.id %>"
                    data-type="<%= category.type %>"
                    <%= transaction && transaction.category_id === category.id ? 'selected' : '' %>
                >
                    <%= category.name %>
                </option>
            <% }); %>
        </select>
    </div>

    <div class="form-group">
        <label for="amount" class="form-label">Amount (â‚¬)</label>
        <input
            type="number"
            id="amount"
            name="amount"
            class="form-input"
            min="0.01"
            step="0.01"
            value="<%= transaction ? transaction.amount : '' %>"
            required
        >
    </div>

    <div class="form-group">
        <label for="description" class="form-label">Description</label>
        <textarea
            id="description"
            name="description"
            class="form-input"
            rows="4"
            minlength="5"
            required
            style="resize: vertical;"
        ><%= transaction ? transaction.description : '' %></textarea>
    </div>

    <% if (!transaction) { %>
        <div class="form-group">
            <label for="documents" class="form-label">Documents (optional)</label>
            <input
                type="file"
                id="documents"
                name="documents"
                class="form-input"
                multiple
                accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx"
            >
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: var(--color-fg); opacity: 0.7;">
                You can also add documents later from the transaction details page.
            </p>
        </div>
    <% } %>

    <button type="submit" class="btn" id="submit-btn">
        <%= transaction ? 'Update Transaction' : 'Create Transaction' %>
    </button>
</form>

<script>
function filterCategories() {
    const selectedType = document.querySelector('input[name="type"]:checked').value;
    const categorySelect = document.getElementById('category_id');
    const options = categorySelect.querySelectorAll('option');

    // Reset selection
    categorySelect.value = '';

    options.forEach(option => {
        if (option.value === '') {
            option.style.display = '';
            return;
        }

        const categoryType = option.getAttribute('data-type');
        // Show if type matches or category is 'both'
        if (categoryType === selectedType || categoryType === 'both') {
            option.style.display = '';
        } else {
            option.style.display = 'none';
        }
    });
}

// Filter on page load
document.addEventListener('DOMContentLoaded', function() {
    filterCategories();
});

// Show loading state on submit
document.getElementById('transaction-form').addEventListener('submit', function(e) {
    const submitBtn = document.getElementById('submit-btn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Processing...';
});
</script>
